<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>tests</title>
</head>
<body>
<script>
    function updateSlide(updatedSlide, pres) {
        return Object.assign(Object.assign({}, pres), {
            slides: pres.slides.map(slide => slide.id === updatedSlide.id
                ? updatedSlide
                : slide)
        });
    }

    function updateElementInSlide(slideId, elementId, updater, pres) {
        const targetSlide = pres.slides.find(slide => slide.id === slideId);
        if (!targetSlide) {
            return pres;
        }
        const updatedSlide = Object.assign(Object.assign({}, targetSlide), {
            elements: targetSlide.elements.map(element => element.id === elementId
                // без тайп гарда ide ругается {}[] из-за map
                ? updater(element)
                : element)
        });
        return updateSlide(updatedSlide, pres);
    }

     function renamePresentation(newName, pres) {
        return Object.assign(Object.assign({}, pres), { title: newName });
    }
     function addSlide(newSlide, pres) {
        return Object.assign(Object.assign({}, pres), { slides: [
                ...pres.slides,
                newSlide
            ] });
    }
     function removeSlide(slideIdsToRemove, pres) {
        const newSlides = pres.slides.filter(slide => !slideIdsToRemove.includes(slide.id));
        const newSelectedSlideIds = pres.selection.selectedSlideIds.filter(id => !slideIdsToRemove.includes(id));
        let newSelection = pres.selection;
        if (!newSelectedSlideIds.length && newSlides.length > 0) {
            newSelection = Object.assign(Object.assign({}, pres.selection), { selectedSlideIds: [newSlides[0].id] });
        }
        else {
            newSelection = Object.assign(Object.assign({}, pres.selection), { selectedSlideIds: newSelectedSlideIds });
        }
        return Object.assign(Object.assign({}, pres), { slides: newSlides, selection: newSelection });
    }
     function moveSlide(slideId, newIndex, pres) {
        const slides = [...pres.slides];
        const curIndex = slides.findIndex(slide => slide.id === slideId);
        if (curIndex === -1 || curIndex === newIndex) {
            return pres;
        }
        const movedSlide = slides.find(slide => slide.id === slideId);
        const filteredSlides = slides.filter(slide => slide.id !== slideId);
        const newSlides = [
            ...filteredSlides.slice(0, newIndex),
            movedSlide,
            ...filteredSlides.slice(newIndex)
        ];
        return Object.assign(Object.assign({}, pres), { slides: newSlides });
    }
     function addElementToSlide(slideId, newElement, pres) {
        const targetSlide = pres.slides.find(slide => slide.id === slideId);
        if (!targetSlide) {
            return pres;
        }
        const updatedSlide = Object.assign(Object.assign({}, targetSlide), { elements: [
                ...targetSlide.elements,
                newElement
            ] });
        return updateSlide(updatedSlide, pres);
    }
     function removeElementsFromSlide(slideId, elementIds, pres) {
        const targetSlide = pres.slides.find(slide => slide.id === slideId);
        if (!targetSlide) {
            return pres;
        }
        const updatedSlide = Object.assign(Object.assign({}, targetSlide), { elements: targetSlide.elements.filter(el => !elementIds.includes(el.id)) });
        const newSelectedElementIds = pres.selection.selectedElementIds.filter(id => !elementIds.includes(id));
        const newSelection = Object.assign(Object.assign({}, pres.selection), { selectedElementIds: newSelectedElementIds });
        return Object.assign(Object.assign({}, updateSlide(updatedSlide, pres)), { selection: newSelection });
    }
     function changeElPosition(slideId, elementId, newPosition, pres) {
        return updateElementInSlide(slideId, elementId, (el) => (Object.assign(Object.assign({}, el), { position: newPosition })), pres);
    }
     function changeElSize(slideId, elementId, newSize, pres) {
        return updateElementInSlide(slideId, elementId, (el) => (Object.assign(Object.assign({}, el), { size: newSize })), pres);
    }
     function changeTextElContent(slideId, elementId, newContent, pres) {
        return updateElementInSlide(slideId, elementId, (el) => (Object.assign(Object.assign({}, el), { content: newContent })), pres);
    }
     function changeFontFamily(slideId, elementId, newFF, pres) {
        return updateElementInSlide(slideId, elementId, (el) => (Object.assign(Object.assign({}, el), { fontFamily: newFF })), pres);
    }
     function changeSlideBg(slideId, newBg, pres) {
        const targetSlide = pres.slides.find(slide => slide.id === slideId);
        if (!targetSlide) {
            return pres;
        }
        const updatedSlide = Object.assign(Object.assign({}, targetSlide), { background: newBg });
        return updateSlide(updatedSlide, pres);
    }
    /* на будущее */
     function setSelectedSlides(slideIds, pres) {
        return Object.assign(Object.assign({}, pres), { selection: Object.assign(Object.assign({}, pres.selection), { selectedSlideIds: slideIds }) });
    }
     function setSelectedElements(elementsIds, pres) {
        return Object.assign(Object.assign({}, pres), { selection: Object.assign(Object.assign({}, pres.selection), { selectedElementIds: elementsIds }) });
    }


    // tests
    const presentationMin = {
        id: '1',
        title: 'testMin',
        slides: [],
        size: {
            x: '0',
            y: '0',
        },
        selection: {
            selectedSlideIds: [],
            selectedElementIds: []
        },
    }

    const slideMin = {
        id: '10',
        background: null,
        elements: [],
    };

    console.log('Тест ф-ии renamePresentation');
    console.log(presentationMin);
    console.log(renamePresentation('newTestMin', presentationMin));
    console.log('');

    console.log('Тест ф-ии addSlide');
    console.log(presentationMin);
    const presentationWithSlides = addSlide(slideMin, presentationMin);
    console.log(presentationWithSlides);
    console.log('');

    console.log('Тест ф-ии removeSlide');
    console.log(presentationWithSlides);
    const presentationWithoutSlides = removeSlide(['10'], presentationWithSlides);
    console.log(presentationWithoutSlides);
    console.log('');

    console.log('Тест ф-ии moveSlide');
    console.log(presentationWithSlides);
    let presentationSeveralSlides = addSlide({
        id: '11',
        background: null,
        elements: [],
    }, addSlide({
        id: '12',
        background: null,
        elements: [],
    }, presentationWithSlides));
    // presentationSeveralSlides = moveSlide('11', 1, presentationWithSlides);
    console.log(moveSlide('11', 2, presentationSeveralSlides));
    console.log('');

    console.log('Тест ф-ии addElementToSlide');
    console.log(presentationSeveralSlides);
    const textEl = {
        id: '100',
        position: {
            x: '0',
            y: '0',
        },
        size: {
            w: '10',
            h: '10'
        },
        type: 'text',
        content: 'test slide element',
        fontFamily: 'Times New Roman',
        fontSize: 14,
        color: '#000',
    }
    console.log('textElement: ', textEl);
    const presSlideWithEl = addElementToSlide('11', textEl, presentationSeveralSlides);
    console.log(presSlideWithEl);
    console.log('');

    console.log('Тест ф-ии removeElementsFromSlide');
    console.log(presSlideWithEl);
    console.log(removeElementsFromSlide('11', ['100'], presSlideWithEl));
    console.log('');

    console.log('Тест ф-ии changeElPosition');
    console.log(presSlideWithEl);
    const newPos = {
        x: '0',
        y: '1'
    };
    console.log(newPos);
    console.log(changeElPosition('11', '100', newPos, presSlideWithEl));
    console.log('');

    console.log('Тест ф-ии changeElSize');
    console.log(presSlideWithEl);
    const newSize = {
        w: '100',
        h: '100'
    };
    console.log(newSize);
    console.log(changeElSize('11', '100', newSize, presSlideWithEl));
    console.log('');

    console.log('Тест ф-ии changeTextElContent');
    console.log(presSlideWithEl);
    console.log(changeTextElContent('11', '100', 'new text content for element', presSlideWithEl));
    console.log('');

    console.log('Тест ф-ии changeFontFamily');
    console.log(presSlideWithEl);
    console.log(changeFontFamily('11', '100', 'Arial', presSlideWithEl));
    console.log('');

    console.log('Тест ф-ии changeSlideBg');
    console.log(presSlideWithEl);
    const newBg = {
        type: 'solid',
        color: '#fff',
    }
    console.log()
    console.log(changeSlideBg('11', newBg, presSlideWithEl));
    console.log('');
</script>
</body>
</html>